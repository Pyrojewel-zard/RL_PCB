# 强化学习PCB训练系统参数说明文档

## 概述

本文档详细说明了强化学习PCB元件训练系统中所有命令行参数的作用和配置方法。该系统支持TD3和SAC两种强化学习算法，用于PCB布局优化任务。

## 参数分类说明

### 1. 强化学习算法参数

#### `--policy`
- **类型**: 字符串
- **默认值**: "TD3"
- **作用**: 指定使用的强化学习策略算法
- **可选值**: "TD3" 或 "SAC"
- **说明**: TD3(Twin Delayed Deep Deterministic)和SAC(Soft Actor-Critic)是两种主流的深度强化学习算法

### 2. 随机种子配置

#### `-s, --seed`
- **类型**: 无符号32位整数数组
- **默认值**: None
- **作用**: 设置Gym、PyTorch和Numpy的随机种子，确保实验可重现性
- **说明**: 可以提供多个种子值，用于多次运行实验

#### `--auto_seed`
- **类型**: 布尔标志
- **默认值**: False
- **作用**: 启用自动种子生成功能
- **说明**: 当启用时，系统会基于当前时间自动生成随机种子，忽略手动设置的种子值

### 3. 训练时间步数控制

#### `--start_timesteps`
- **类型**: 整数
- **默认值**: 25000
- **作用**: 设置初始随机策略执行的时间步数
- **说明**: 在训练初期使用随机策略进行探索，有助于经验回放缓冲区的初始化

#### `--max_timesteps`
- **类型**: 整数
- **默认值**: 1000000
- **作用**: 设置环境运行的最大时间步数
- **说明**: 控制整个训练过程的总长度，影响训练时间和模型性能

#### `--target_exploration_steps`
- **类型**: 整数
- **默认值**: 10000
- **作用**: 设置目标探索步数
- **说明**: 用于控制探索策略的执行时长

### 4. 模型管理参数

#### `--save_model`
- **类型**: 布尔标志
- **默认值**: False
- **作用**: 启用模型和优化器参数的保存功能
- **说明**: 当启用时，训练过程中会定期保存模型检查点

#### `--load_model`
- **类型**: 字符串
- **默认值**: ""
- **作用**: 指定要加载的模型文件名
- **说明**: 空字符串表示不加载，"default"使用默认文件名

#### `--expert_model`
- **类型**: 字符串
- **默认值**: None
- **作用**: 指定专家模型路径
- **说明**: 用于专家参数探索，提供预训练的高质量策略作为指导

### 5. 奖励函数权重参数

#### `-w`
- **类型**: 32位浮点数
- **默认值**: 1.0
- **作用**: 权重参数，用于奖励函数的加权计算
- **说明**: 调节不同奖励项在总奖励中的重要性

#### `--hpwl`
- **类型**: 32位浮点数
- **默认值**: 1.0
- **作用**: Half-Perimeter Wire Length(半周长线长)权重
- **说明**: 控制线长优化在奖励函数中的权重，影响布线质量

#### `-o`
- **类型**: 32位浮点数
- **默认值**: 1.0
- **作用**: 重叠惩罚权重参数
- **说明**: 控制元件重叠惩罚在奖励函数中的权重

### 6. 数据集配置

#### `--training_pcb`
- **类型**: 字符串
- **默认值**: None
- **作用**: 指定训练用PCB文件路径
- **说明**: 定义用于训练的PCB布局数据

#### `--evaluation_pcb`
- **类型**: 字符串
- **默认值**: None
- **作用**: 指定评估用PCB文件路径
- **说明**: 定义用于性能评估的PCB布局数据

#### `--pcb_idx`
- **类型**: 整数
- **默认值**: -1
- **作用**: 指定特定PCB索引用于训练
- **说明**: 当提供时，系统将使用指定索引的PCB进行训练

### 7. 日志和监控

#### `--tensorboard_dir`
- **类型**: 字符串
- **默认值**: "./tensorboard"
- **作用**: 指定TensorBoard日志目录
- **说明**: 用于存储训练过程的可视化数据和指标

#### `--experiment`
- **类型**: 字符串
- **默认值**: None
- **作用**: 描述性实验名称
- **说明**: 用于标识和区分不同的实验运行

#### `--verbose`
- **类型**: 整数
- **默认值**: 0
- **作用**: 控制程序输出详细程度
- **说明**: 数值越大，输出的调试信息越详细

### 8. 性能优化参数

#### `--incremental_replay_buffer`
- **类型**: 字符串枚举
- **默认值**: None
- **可选值**: None, "double", "triple", "quadruple"
- **作用**: 设置增量回放缓冲区类型
- **说明**: 通过增加缓冲区容量来改善学习效果

#### `--device`
- **类型**: 字符串枚举
- **默认值**: "cuda"
- **可选值**: "cuda", "cpu"
- **作用**: 指定计算设备类型
- **说明**: 优先使用GPU加速，若GPU不可用则自动切换到CPU

#### `--enable_multithread`
- **类型**: 字符串
- **默认值**: "true"
- **作用**: 启用多线程优化
- **说明**: 提升并行计算性能，加速训练过程

#### `--enable_gpu_optimization`
- **类型**: 字符串
- **默认值**: "true"
- **作用**: 启用GPU优化
- **说明**: 开启GPU相关的性能优化选项

#### `--num_workers`
- **类型**: 整数
- **默认值**: 6
- **作用**: 设置工作线程数量
- **说明**: 控制并行处理的线程数，影响数据处理速度

### 9. 实验管理参数

#### `--runs`
- **类型**: 32位整数
- **默认值**: 1
- **作用**: 设置实验运行次数
- **说明**: 支持多次运行同一实验配置，用于统计分析

#### `--workers`
- **类型**: 整数
- **默认值**: 2
- **作用**: 设置执行多次运行的工作进程数
- **说明**: 控制并行执行实验的进程数量

#### `--hyperparameters`
- **类型**: 字符串
- **默认值**: None
- **作用**: 指定超参数文件路径
- **说明**: 从外部文件加载超参数配置，便于实验管理

### 10. 评估和监控频率

#### `--evaluate_every`
- **类型**: 无符号32位整数
- **默认值**: 250000
- **作用**: 设置评估执行频率（时间步数）
- **说明**: 控制多久进行一次性能评估

#### `--early_stopping`
- **类型**: 整数
- **默认值**: None
- **作用**: 早停机制参数
- **说明**: 当连续指定步数内无改善时，提前终止训练，基于最近100个回合的平均奖励进行比较

#### `--pcb_save_freq`
- **类型**: 整数
- **默认值**: None
- **作用**: PCB文件实时保存频率
- **说明**: 指定每隔多少训练步数保存一次PCB状态文件，用于训练过程监控

### 11. 数据处理配置

#### `--shuffle_training_idxs`
- **类型**: 布尔标志
- **默认值**: False
- **作用**: 启用训练时智能体索引洗牌
- **说明**: 增加训练数据的随机性，提升模型泛化能力

#### `--shuffle_evaluation_idxs`
- **类型**: 布尔标志
- **默认值**: False
- **作用**: 启用评估时智能体索引洗牌
- **说明**: 确保评估过程的公平性和随机性

### 12. 输出重定向

#### `--redirect_stdout`
- **类型**: 布尔标志
- **默认值**: False
- **作用**: 将标准输出重定向到文件
- **说明**: 便于长时间训练的日志管理和后续分析

#### `--redirect_stderr`
- **类型**: 布尔标志
- **默认值**: False
- **作用**: 将标准错误输出重定向到文件
- **说明**: 分离错误信息，便于调试和问题定位

## 使用示例

### 基础训练命令
```bash
python train.py --policy TD3 --max_timesteps 1000000 --save_model --training_pcb dataset/train.pcb
```

### 高级配置示例
```bash
python train.py \
    --policy SAC \
    --seed 42 \
    --max_timesteps 2000000 \
    --start_timesteps 50000 \
    --save_model \
    --training_pcb dataset/training.pcb \
    --evaluation_pcb dataset/evaluation.pcb \
    --tensorboard_dir ./logs/experiment_1 \
    --experiment "SAC_optimization_v1" \
    --hpwl 1.5 \
    --w 0.8 \
    --o 2.0 \
    --device cuda \
    --enable_multithread true \
    --num_workers 8 \
    --evaluate_every 100000 \
    --pcb_save_freq 50000 \
    --runs 5 \
    --workers 3
```

## 注意事项

1. **GPU使用**: 当指定`--device cuda`但GPU不可用时，系统会自动回退到CPU
2. **种子配置**: `--auto_seed`会覆盖手动设置的种子值
3. **文件路径**: 确保PCB文件路径正确且可访问
4. **内存管理**: 大型PCB文件和高频率保存可能占用大量磁盘空间
5. **并行处理**: 调整`--num_workers`和`--workers`参数时需考虑系统资源限制

## 参数优化建议

1. **训练稳定性**: 建议设置固定种子值以确保结果可重现
2. **性能平衡**: 根据PCB复杂度调整奖励权重参数(`--hpwl`, `-w`, `-o`)
3. **计算效率**: 合理配置多线程和GPU优化参数
4. **实验管理**: 使用描述性实验名称和适当的日志目录结构
5. **早停策略**: 根据训练数据规模设置合适的早停参数
