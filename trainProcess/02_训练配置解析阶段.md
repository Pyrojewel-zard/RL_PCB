# 02. 训练配置解析阶段

## 概述
训练配置解析阶段负责读取和解析`run_config.txt`文件，该文件包含多个训练任务的配置信息，每个任务对应不同的参数组合。

## 详细流程

### 2.1 run_config.txt文件结构
```bash
# 实验1：参数组合 622 (w=6.0, hpwl=2.0, o=2.0)
CUDA_VISIBLE_DEVICES=0 python train.py --policy SAC --target_exploration_steps 1000 --start_timesteps 5_000 --max_timesteps 600_000 --evaluate_every 10_000_000 --training_pcb ${RL_PCB}/dataset/base/training.pcb --evaluation_pcb ${RL_PCB}/dataset/base/evaluation.pcb --tensorboard_dir ${EXP_DIR}/work -w 6.0 --hpwl 2.0 -o 2.0 --hyperparameters  ${EXP_DIR}/hyperparameters/hp_sac.json --incremental_replay_buffer double --verbose 0 --runs 4 --experiment parameter_experiment_622 --device cuda --pcb_save_freq 1000 

# 实验2：参数组合 262 (w=2.0, hpwl=6.0, o=2.0)
CUDA_VISIBLE_DEVICES=1 python train.py --policy SAC --target_exploration_steps 1000 --start_timesteps 5_000 --max_timesteps 600_000 --evaluate_every 10_000_000 --training_pcb ${RL_PCB}/dataset/base/training.pcb --evaluation_pcb ${RL_PCB}/dataset/base/evaluation.pcb --tensorboard_dir ${EXP_DIR}/work -w 2.0 --hpwl 6.0 -o 2.0 --hyperparameters  ${EXP_DIR}/hyperparameters/hp_sac.json --incremental_replay_buffer double --verbose 0 --runs 4 --experiment parameter_experiment_262 --device cuda --pcb_save_freq 1000 

# 实验3：参数组合 226 (w=2.0, hpwl=2.0, o=6.0)
CUDA_VISIBLE_DEVICES=0 python train.py --policy SAC --target_exploration_steps 1000 --start_timesteps 5_000 --max_timesteps 600_000 --evaluate_every 10_000_000 --training_pcb ${RL_PCB}/dataset/base/training.pcb --evaluation_pcb ${RL_PCB}/dataset/base/evaluation.pcb --tensorboard_dir ${EXP_DIR}/work -w 2.0 --hpwl 2.0 -o 6.0 --hyperparameters  ${EXP_DIR}/hyperparameters/hp_sac.json --incremental_replay_buffer double --verbose 0 --runs 4 --experiment parameter_experiment_226 --device cuda --pcb_save_freq 1000 

# 实验4：参数组合 442 (w=4.0, hpwl=4.0, o=2.0)
CUDA_VISIBLE_DEVICES=1 python train.py --policy SAC --target_exploration_steps 1000 --start_timesteps 5_000 --max_timesteps 600_000 --evaluate_every 10_000_000 --training_pcb ${RL_PCB}/dataset/base/training.pcb --evaluation_pcb ${RL_PCB}/dataset/base/evaluation.pcb --tensorboard_dir ${EXP_DIR}/work -w 4.0 --hpwl 4.0 -o 2.0 --hyperparameters  ${EXP_DIR}/hyperparameters/hp_sac.json --incremental_replay_buffer double --verbose 0 --runs 4 --experiment parameter_experiment_442 --device cuda --pcb_save_freq 1000 
```

### 2.2 参数组合分析

#### 实验命名规则
实验名称格式：`parameter_experiment_XXX`
- XXX = w值 + hpwl值 + o值
- 例如：622 = w=6.0, hpwl=2.0, o=2.0

#### 参数组合对比
| 实验 | w值 | hpwl值 | o值 | GPU设备 | 说明 |
|------|-----|--------|-----|---------|------|
| 622  | 6.0 | 2.0    | 2.0 | 0       | 高欧几里得距离权重 |
| 262  | 2.0 | 6.0    | 2.0 | 1       | 高HPWL权重 |
| 226  | 2.0 | 2.0    | 6.0 | 0       | 高重叠惩罚权重 |
| 442  | 4.0 | 4.0    | 2.0 | 1       | 平衡权重配置 |

### 2.3 关键参数解析

#### 2.3.1 训练策略参数
```bash
--policy SAC                    # 使用SAC算法
--target_exploration_steps 1000 # 目标探索步数
--start_timesteps 5_000         # 初始随机策略步数
--max_timesteps 600_000         # 最大训练步数
--evaluate_every 10_000_000     # 评估频率
```

#### 2.3.2 数据文件参数
```bash
--training_pcb ${RL_PCB}/dataset/base/training.pcb     # 训练PCB文件
--evaluation_pcb ${RL_PCB}/dataset/base/evaluation.pcb # 评估PCB文件
--hyperparameters ${EXP_DIR}/hyperparameters/hp_sac.json # 超参数文件
```

#### 2.3.3 奖励权重参数
```bash
-w 6.0      # 欧几里得距离权重
--hpwl 2.0  # HPWL权重
-o 2.0      # 重叠惩罚权重
```

#### 2.3.4 训练配置参数
```bash
--incremental_replay_buffer double  # 增量回放缓冲区类型
--verbose 0                         # 详细输出级别
--runs 4                           # 运行次数
--device cuda                      # 计算设备
--pcb_save_freq 1000              # PCB保存频率
```

### 2.4 调度器处理流程

#### 2.4.1 并行执行管理
```bash
# 调度器使用信号量控制并行实例数
open_sem $N  # 初始化N个令牌的信号量

# 每个训练任务占用一个令牌
run_with_lock task "$line"
```

#### 2.4.2 任务执行
```bash
while read -r line; 
do
    run_with_lock task "$line"  # 并行执行训练任务
    sleep 1
    echo $line
done < $RUN_CONFIG
```

### 2.5 环境变量替换

#### 2.5.1 路径变量
- `${RL_PCB}`：项目根目录
- `${EXP_DIR}`：实验目录
- `${EXP_DIR}/work`：工作目录

#### 2.5.2 GPU设备分配
- 实验1和3：`CUDA_VISIBLE_DEVICES=0`
- 实验2和4：`CUDA_VISIBLE_DEVICES=1`

## 关键文件

### run_config.txt
- **位置**：`experiments/00_parameter_exeperiments/run_config.txt`
- **功能**：定义多个训练任务的配置
- **格式**：每行一个完整的训练命令

### hyperparameters/hp_sac.json
- **位置**：`experiments/00_parameter_exeperiments/hyperparameters/hp_sac.json`
- **功能**：SAC算法的超参数配置

## 输出信息
```
Run configuration file         : experiments/00_parameter_exeperiments/run_config.txt
Concurrent runs                : 8
Logfile                        : experiments/00_parameter_exeperiments/scheduler.log
Do you want to continue?[Y/n] Y
Starting ...
```

## 下一步
进入[03_训练脚本启动阶段](./03_训练脚本启动阶段.md) 